{"ast":null,"code":"import _asyncToGenerator from \"C:/SCCBD/PROYECTO FINAL/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as rsa from 'my-modulos';\nimport * as bc from 'bigint-conversion';\nimport { firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class VotosService {\n  constructor(http) {\n    this.http = http;\n    this.URI = \"http://localhost:3000\";\n    this.initialized = new Promise((resolve, reject) => {\n      this.init().then(() => {\n        resolve();\n      }).catch(() => {\n        reject();\n      });\n    });\n  }\n\n  init() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const keyPair = yield rsa.generateKeys();\n      _this.privateKey = keyPair.privateKey;\n      _this.publicKey = keyPair.publicKey;\n      const receivedPublicKey = yield firstValueFrom(_this.getPublicKey());\n      _this.serverPublicKey = jsonToPublicKey(receivedPublicKey);\n      console.log(\"Parametros de Public key: \" + \"\\ne: \" + _this.publicKey.e + \"\\nm: \" + _this.publicKey.n);\n      console.log(\"Parametros de Private key: \" + \"\\nd: \" + _this.privateKey.d + \"\\nn: \" + _this.privateKey.n);\n    })();\n  }\n\n  mensajeCifrado(mensaje, pubKey) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.initialized;\n      const path = `${_this2.URI}/votos/encrypt`;\n      return _this2.http.post(path, {\n        message: mensaje,\n        pubKey: publicKeyToJson(pubKey)\n      });\n    })();\n  }\n\n  decrypt(mensaje) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this3.initialized;\n      return yield firstValueFrom(_this3.http.post(_this3.URI + '/votos/decrypt', {\n        message: mensaje\n      }));\n    })();\n  }\n\n  sign(mensaje) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this4.http.post(_this4.URI + '/votos/sign', {\n        message: mensaje\n      });\n    })();\n  }\n\n  firmaciega(mensaje) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this5.initialized;\n      return _this5.http.post(_this5.URI + '/votos/sign', {\n        message: mensaje\n      });\n    })();\n  }\n\n  verify(mensaje, pubKey) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this6.initialized;\n      return _this6.http.post(_this6.URI + '/votos/verify', {\n        message: mensaje,\n        pubKey: publicKeyToJson(pubKey)\n      });\n    })();\n  }\n\n  getPublicKey() {\n    return this.http.get(this.URI + \"/votos/publickey\");\n  }\n\n}\n\nVotosService.ɵfac = function VotosService_Factory(t) {\n  return new (t || VotosService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nVotosService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: VotosService,\n  factory: VotosService.ɵfac,\n  providedIn: 'root'\n});\n\nfunction publicKeyToJson(pubKey) {\n  return {\n    e: bc.bigintToHex(pubKey.e),\n    n: bc.bigintToHex(pubKey.e)\n  };\n}\n\nfunction jsonToPublicKey(pubKeyJson) {\n  return new rsa.PublicKey(bc.hexToBigint(pubKeyJson.e), bc.hexToBigint(pubKeyJson.n));\n}","map":{"version":3,"sources":["C:/SCCBD/PROYECTO FINAL/frontend/src/app/services/votos.service.ts"],"names":["rsa","bc","firstValueFrom","i0","i1","VotosService","constructor","http","URI","initialized","Promise","resolve","reject","init","then","catch","keyPair","generateKeys","privateKey","publicKey","receivedPublicKey","getPublicKey","serverPublicKey","jsonToPublicKey","console","log","e","n","d","mensajeCifrado","mensaje","pubKey","path","post","message","publicKeyToJson","decrypt","sign","firmaciega","verify","get","ɵfac","VotosService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn","bigintToHex","pubKeyJson","PublicKey","hexToBigint"],"mappings":"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","sourcesContent":["import * as rsa from 'my-modulos';\r\nimport * as bc from 'bigint-conversion';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common/http\";\r\nexport class VotosService {\r\n    constructor(http) {\r\n        this.http = http;\r\n        this.URI = \"http://localhost:3000\";\r\n        this.initialized = new Promise((resolve, reject) => {\r\n            this.init().then(() => {\r\n                resolve();\r\n            }).catch(() => {\r\n                reject();\r\n            });\r\n        });\r\n    }\r\n    async init() {\r\n        const keyPair = await rsa.generateKeys();\r\n        this.privateKey = keyPair.privateKey;\r\n        this.publicKey = keyPair.publicKey;\r\n        const receivedPublicKey = await firstValueFrom(this.getPublicKey());\r\n        this.serverPublicKey = jsonToPublicKey(receivedPublicKey);\r\n        console.log(\"Parametros de Public key: \" + \"\\ne: \" + this.publicKey.e + \"\\nm: \" + this.publicKey.n);\r\n        console.log(\"Parametros de Private key: \" + \"\\nd: \" + this.privateKey.d + \"\\nn: \" + this.privateKey.n);\r\n    }\r\n    async mensajeCifrado(mensaje, pubKey) {\r\n        await this.initialized;\r\n        const path = `${this.URI}/votos/encrypt`;\r\n        return this.http.post(path, {\r\n            message: mensaje,\r\n            pubKey: publicKeyToJson(pubKey)\r\n        });\r\n    }\r\n    async decrypt(mensaje) {\r\n        await this.initialized;\r\n        return await firstValueFrom(this.http.post(this.URI + '/votos/decrypt', { message: mensaje }));\r\n    }\r\n    async sign(mensaje) {\r\n        return this.http.post(this.URI + '/votos/sign', { message: mensaje });\r\n    }\r\n    async firmaciega(mensaje) {\r\n        await this.initialized;\r\n        return this.http.post(this.URI + '/votos/sign', { message: mensaje });\r\n    }\r\n    async verify(mensaje, pubKey) {\r\n        await this.initialized;\r\n        return this.http.post(this.URI + '/votos/verify', { message: mensaje, pubKey: publicKeyToJson(pubKey) });\r\n    }\r\n    getPublicKey() {\r\n        return this.http.get(this.URI + \"/votos/publickey\");\r\n    }\r\n}\r\nVotosService.ɵfac = function VotosService_Factory(t) { return new (t || VotosService)(i0.ɵɵinject(i1.HttpClient)); };\r\nVotosService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: VotosService, factory: VotosService.ɵfac, providedIn: 'root' });\r\nfunction publicKeyToJson(pubKey) {\r\n    return {\r\n        e: bc.bigintToHex(pubKey.e),\r\n        n: bc.bigintToHex(pubKey.e)\r\n    };\r\n}\r\nfunction jsonToPublicKey(pubKeyJson) {\r\n    return new rsa.PublicKey(bc.hexToBigint(pubKeyJson.e), bc.hexToBigint(pubKeyJson.n));\r\n}\r\n"]},"metadata":{},"sourceType":"module"}