{"ast":null,"code":"import _asyncToGenerator from \"C:/SCCBD/PROYECTO FINAL/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as rsa from 'my-modulos';\nimport * as bc from 'bigint-conversion';\nimport { firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class VotosService {\n  constructor(http) {\n    this.http = http;\n    this.URI = \"http://localhost:3000\";\n    this.initialized = new Promise((resolve, reject) => {\n      this.init().then(() => {\n        resolve();\n      }).catch(() => {\n        reject();\n      });\n    });\n  }\n\n  init() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const keyPair = yield rsa.generateKeys();\n      _this.privateKey = keyPair.privateKey;\n      _this.publicKey = keyPair.publicKey;\n      const receivedPublicKey = yield firstValueFrom(_this.getPublicKey());\n      _this.serverPublicKey = jsonToPublicKey(receivedPublicKey);\n      console.log(\"Parametros de Public key: \" + \"\\ne: \" + _this.publicKey.e + \"\\nm: \" + _this.publicKey.n);\n      console.log(\"Parametros de Private key: \" + \"\\nd: \" + _this.privateKey.d + \"\\nn: \" + _this.privateKey.n);\n    })();\n  }\n\n  decrypt(mensaje) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield firstValueFrom(_this2.http.post(_this2.URI + '/votos/decrypt', {\n        message: mensaje\n      }));\n    })();\n  }\n\n  sign(mensaje) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this3.http.post(_this3.URI + '/votos/sign', {\n        message: mensaje\n      });\n    })();\n  }\n\n  verify(mensaje, pubKey) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      return _this4.http.post(_this4.URI + '/votos/verify', {\n        message: mensaje,\n        pubKey: publicKeyToJson(pubKey)\n      });\n    })();\n  }\n\n  getPublicKey() {\n    return this.http.get(this.URI + \"/votos/publickey\");\n  }\n\n}\n\nVotosService.ɵfac = function VotosService_Factory(t) {\n  return new (t || VotosService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nVotosService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: VotosService,\n  factory: VotosService.ɵfac,\n  providedIn: 'root'\n});\n\nfunction publicKeyToJson(pubKey) {\n  return {\n    e: bc.bigintToHex(pubKey.e),\n    n: bc.bigintToHex(pubKey.e)\n  };\n}\n\nfunction jsonToPublicKey(pubKeyJson) {\n  return new rsa.PublicKey(bc.hexToBigint(pubKeyJson.e), bc.hexToBigint(pubKeyJson.n));\n}","map":{"version":3,"sources":["C:/SCCBD/PROYECTO FINAL/frontend/src/app/services/votos.service.ts"],"names":["rsa","bc","firstValueFrom","i0","i1","VotosService","constructor","http","URI","initialized","Promise","resolve","reject","init","then","catch","keyPair","generateKeys","privateKey","publicKey","receivedPublicKey","getPublicKey","serverPublicKey","jsonToPublicKey","console","log","e","n","d","decrypt","mensaje","post","message","sign","verify","pubKey","publicKeyToJson","get","ɵfac","VotosService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn","bigintToHex","pubKeyJson","PublicKey","hexToBigint"],"mappings":"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","sourcesContent":["import * as rsa from 'my-modulos';\r\nimport * as bc from 'bigint-conversion';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common/http\";\r\nexport class VotosService {\r\n    constructor(http) {\r\n        this.http = http;\r\n        this.URI = \"http://localhost:3000\";\r\n        this.initialized = new Promise((resolve, reject) => {\r\n            this.init().then(() => {\r\n                resolve();\r\n            }).catch(() => {\r\n                reject();\r\n            });\r\n        });\r\n    }\r\n    async init() {\r\n        const keyPair = await rsa.generateKeys();\r\n        this.privateKey = keyPair.privateKey;\r\n        this.publicKey = keyPair.publicKey;\r\n        const receivedPublicKey = await firstValueFrom(this.getPublicKey());\r\n        this.serverPublicKey = jsonToPublicKey(receivedPublicKey);\r\n        console.log(\"Parametros de Public key: \" + \"\\ne: \" + this.publicKey.e + \"\\nm: \" + this.publicKey.n);\r\n        console.log(\"Parametros de Private key: \" + \"\\nd: \" + this.privateKey.d + \"\\nn: \" + this.privateKey.n);\r\n    }\r\n    async decrypt(mensaje) {\r\n        return await firstValueFrom(this.http.post(this.URI + '/votos/decrypt', { message: mensaje }));\r\n    }\r\n    async sign(mensaje) {\r\n        return this.http.post(this.URI + '/votos/sign', { message: mensaje });\r\n    }\r\n    async verify(mensaje, pubKey) {\r\n        return this.http.post(this.URI + '/votos/verify', { message: mensaje, pubKey: publicKeyToJson(pubKey) });\r\n    }\r\n    getPublicKey() {\r\n        return this.http.get(this.URI + \"/votos/publickey\");\r\n    }\r\n}\r\nVotosService.ɵfac = function VotosService_Factory(t) { return new (t || VotosService)(i0.ɵɵinject(i1.HttpClient)); };\r\nVotosService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: VotosService, factory: VotosService.ɵfac, providedIn: 'root' });\r\nfunction publicKeyToJson(pubKey) {\r\n    return {\r\n        e: bc.bigintToHex(pubKey.e),\r\n        n: bc.bigintToHex(pubKey.e)\r\n    };\r\n}\r\nfunction jsonToPublicKey(pubKeyJson) {\r\n    return new rsa.PublicKey(bc.hexToBigint(pubKeyJson.e), bc.hexToBigint(pubKeyJson.n));\r\n}\r\n"]},"metadata":{},"sourceType":"module"}